{"version":3,"sources":["assets\\Script\\Manager\\UIManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\nimport UIParent from \"../Base/UIParent\";\nimport GameCtrl from \"../Ctrl/GameCtrl\";\nimport SdkCtrl from \"../Ctrl/SdkCtrl\";\nimport GameData from \"../Other/GameData\";\nimport SoundMgr from \"../Other/SoundMgr\";\n\nexport enum WinID {\n    GameSetting = \"GameSetting\",\n    HomeMain = \"HomeMain\",\n    OtherGameMain = \"OtherGameMain\",\n    PopUpMain = \"PopUpMain\",\n    TipMain = \"TipMain\",\n}\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class UIManager extends cc.Component {\n    @property(cc.ProgressBar)\n    loadBar: cc.ProgressBar = null;\n    @property(cc.Node)\n    panelParent: cc.Node = null;\n    @property(cc.Node)\n    tipParent: cc.Node = null;\n    @property(cc.Label)\n    versions: cc.Label = null;\n\n    allUIPanel: UIParent[] = [];\n    UIPlaneDictionary: { [key: string]: UIParent; } = {};\n    isload: boolean = false\n    isShow: boolean = false;\n    loadStateList: boolean[] = []\n    public static share: UIManager;\n\n    onLoad() {\n        // cc.sys.localStorage.removeItem(\"LocalData\")\n        UIManager.share = this;\n        let view = cc.view.getFrameSize()\n        if (view.height / view.width < 10 / 17) {//1.7\n            GameData.sizeType = view.height / (view.width * (10 / 17));\n        }\n\n        this.LoadUIPanel();\n\n        // GameUtils.getInstance().setString(this.versions, VersionsData.Versions)\n\n        // cc.director.getPhysicsManager().enabled = true\n        // cc.director.getCollisionManager().enabled = true\n        // cc.director.getPhysicsManager().debugDrawFlags = cc.PhysicsManager.DrawBits.e_aabbBit |\n        // cc.PhysicsManager.DrawBits.e_jointBit |\n        // cc.PhysicsManager.DrawBits.e_shapeBit;\n\n        SdkCtrl.getInstance().showShareMenu()\n        cc.game.on(cc.game.EVENT_SHOW, () => {\n            //打开游戏界面\n            let eventList = GameData.showGameEvent\n            for (let index = 0; index < eventList.length; index++) {\n                eventList[index]()\n            }\n            GameData.showGameEvent = []\n            // this.sendEvent(GameEvent.UpdataVit)\n        })\n        cc.game.on(cc.game.EVENT_HIDE, () => {\n            //关闭游戏界面\n            let eventList = GameData.hideGameEvent\n            for (let index = 0; index < eventList.length; index++) {\n                eventList[index]()\n            }\n            GameData.hideGameEvent = []\n        })\n    }\n\n    start() {\n        this.LoadGameBundle();\n        this.startPor();\n    }\n\n    LoadUIPanel() {\n        let uiPath = [];\n        let uiPanel = [\n            WinID.HomeMain,\n            WinID.TipMain,\n            WinID.OtherGameMain,\n        ];\n        for (let i = 0; i < uiPanel.length; i++) {\n            uiPath[i] = \"UIPanel/\" + uiPanel[i] + \"/\" + uiPanel[i];\n        }\n        cc.loader.loadResArray(uiPath, cc.Prefab, (completedCount: number, totalCount: number, item: any) => {\n            //console.log(completedCount, totalCount, item);\n        }, (msg: Error, res: any[]) => {\n            //console.log(msg, res);\n            for (let i = 0; i < res.length; i++) {\n                let obj = cc.instantiate(res[i]);\n                if (obj.name == WinID.TipMain) {\n                    obj.parent = this.tipParent\n                } else {\n                    obj.parent = this.panelParent;\n                }\n                let uiPlaneSpr = obj.getComponent(obj.name);\n                this.UIPlaneDictionary[obj.name] = uiPlaneSpr;\n                obj.active = false;\n            }\n            this.isload = true;\n\n\n        })\n    }\n\n    LoadGameBundle() {\n        let nowIndex = this.loadStateList.length\n        this.loadStateList[nowIndex] = false\n        cc.assetManager.loadBundle('Game', (err, bundle) => {\n            this.loadStateList[nowIndex] = true\n\n            let nowIndex1 = this.loadStateList.length\n            this.loadStateList[nowIndex1] = false\n            bundle.loadDir(\"Music\", cc.AudioClip, (err, clips: any) => {\n                for (let i = 0; i < clips.length; i++) {\n                    SoundMgr.getInstance().addSound(clips[i].name, clips[i]);\n                }\n                SoundMgr.getInstance().playMusic(\"BGM\")\n                this.loadStateList[nowIndex1] = true\n            });\n        });\n    }\n\n    startPor() {\n        let count = 0;\n        this.loadBar.progress = count;\n        let callback = (event) => {\n            if (count >= 0.9) {\n                if (this.isload && this.checkIsLoadSuccess()) {\n                    count += 0.015;\n                }\n            } else {\n                count += 0.015;\n            }\n            this.loadBar.progress = count;\n            if (count >= 1) {\n                this.isShow = true;\n                this.unschedule(callback);\n                this.loadBar.node.parent.active = false;\n                GameCtrl.getInstance().checkDayIsToday()\n                for (let i in this.UIPlaneDictionary) {\n                    this.UIPlaneDictionary[i].InitUI(this);\n                }\n                this.ShowUIName(WinID.HomeMain);\n            }\n        }\n        this.schedule(callback, 0.02);\n    }\n\n    checkIsLoadSuccess() {\n        for (let index = 0; index < this.loadStateList.length; index++) {\n            let state = this.loadStateList[index];\n            if (!state) {\n                return false\n            }\n        }\n        return true\n    }\n\n    ShowUIName(uiName: WinID, data: any = null, fun = () => { }) {\n        if (this.UIPlaneDictionary[uiName]) {\n            this.UIPlaneDictionary[uiName].ShowUI(data, fun);\n        } else {\n            cc.log(\"空界面\")\n        }\n    }\n\n    HideUIName(uiName) {\n        if (this.UIPlaneDictionary[uiName]) {\n            this.UIPlaneDictionary[uiName].onClickClose();\n        } else {\n            cc.log(\"空界面\")\n        }\n    }\n\n    showTip(str: string) {\n        this.ShowUIName(WinID.TipMain, str)\n    }\n\n    GetUIPanl(uiName): any {\n        return this.UIPlaneDictionary[uiName];\n    }\n}"]}