{"version":3,"sources":["assets\\Script\\Ctrl\\GameCtrl.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { GameEvent } from \"../Config/GameEventConfig\";\nimport GameEventManager from \"../Manager/GameEventManager\";\nimport GameData, { GameState, ItemInfo } from \"../Other/GameData\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class GameCtrl {\n    private static _instance: GameCtrl = null;\n\n    private _isNewGame: boolean = false\n    private _itemList: { [key: number]: ItemInfo } = null\n    private _gameState: GameState = GameState.waitStart\n    // private _selectLevelInfo: LevelConfigBasic = null\n\n    public static getInstance() {\n        if (!this._instance) {\n            this._instance = new GameCtrl();\n            this._instance._init();\n        }\n        return this._instance;\n    }\n\n    public static destroyInstance() {\n        if (this._instance) {\n            this._instance._destroy();\n            delete this._instance;\n            this._instance = null;\n        }\n    }\n\n    private _init() {\n\n    }\n\n    private _destroy() { }\n\n    clearData() {\n\n    }\n\n    setGameState(state: GameState) {\n        this._gameState = state\n    }\n\n    getGameState() {\n        return this._gameState\n    }\n\n    /** 获得全部道具数组 */\n    getAllItemList() {\n        if (!this._itemList) {\n            let data = GameData.getLocalData(\"ItemList\")\n            this._itemList = data ? data : {}\n        }\n        return this._itemList\n    }\n\n    /** 设置道具数量 */\n    setItemCount(itemType: number, count: number) {\n        let itemList = this.getAllItemList()\n        if (count > 0) {\n            itemList[itemType] = { itemID: itemType, itemCount: count } as ItemInfo\n        } else if (count == 0) {\n            delete itemList[itemType]\n        }\n        GameData.saveLocalData(\"ItemList\", itemList)\n    }\n\n    /** 获得道具数量 */\n    getItemCount(itemType: number) {\n        let itemList = this.getAllItemList()\n        if (!itemList[itemType]) {\n            return 0\n        }\n        return itemList[itemType].itemCount\n    }\n\n    /** 获得奖励道具 */\n    addAward(itemInfoList: ItemInfo[], isShowUI: boolean = false) {\n        for (let index = 0; index < itemInfoList.length; index++) {\n            let itemInfo = itemInfoList[index];\n            let goldCount = this.getItemCount(itemInfo.itemID)\n            goldCount += itemInfo.itemCount\n            this.setItemCount(itemInfo.itemID, goldCount)\n        }\n        // if (isShowUI && itemInfoList.length > 0) {\n        //     UIManager.share.ShowUIName(WinID.ShowAwardMain, itemInfoList)\n        // }\n    }\n\n    /** 消耗金币道具统一接口 */\n    costItem(itemInfoList: ItemInfo[]) {\n        for (let index = 0; index < itemInfoList.length; index++) {\n            let itemInfo = itemInfoList[index];\n            let goldCount = this.getItemCount(itemInfo.itemID)\n            goldCount -= itemInfo.itemCount\n            this.setItemCount(itemInfo.itemID, goldCount)\n        }\n    }\n\n     /** 游戏刚打开，检测是不是今天 */\n     checkDayIsToday() {\n        let dayData = GameData.getLocalData(\"NowDay\")\n        let isNowDay = false\n        if (dayData == null || dayData == undefined) {\n            //今天是新的一天\n            isNowDay = true\n        } else {\n            let signDate = new Date(dayData)\n            let signStr = signDate.getFullYear() + \"_\" + signDate.getMonth() + \"_\" + signDate.getDate()\n            let nowDate = new Date(new Date().getTime())\n            let nowStr = nowDate.getFullYear() + \"_\" + nowDate.getMonth() + \"_\" + nowDate.getDate()\n            isNowDay = signStr != nowStr\n        }\n        if (isNowDay) {\n            //今天是新的一天\n            GameData.saveLocalData(\"NowDay\", new Date().getTime())\n\n            // //更新每日奖励次数\n            // this.updateEverydayAwardTime()\n            // //更新每日签到状态\n            // SignCtrl.getInstance().updateSignData()\n            // //初始化每日任务\n            // TaskCtrl.getInstance().clearTaskTime()\n            // //更新任务条件\n            // TaskCtrl.getInstance().addTaskTime(TaskID.login)\n            // //更新副本数据\n            // SecretAreaCtrl.getInstance().resetSecretAreaData()\n        }\n    }\n\n    sendEvent(eventId: GameEvent, data: any = null) {\n        GameEventManager.getInstance().dispathcGameEvent(eventId, data);\n    }\n}\n"]}